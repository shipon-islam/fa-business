(()=>{var e={};e.id=8778,e.ids=[8778],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9819:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>h,serverHooks:()=>x,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>m,POST:()=>f});var s=r(96559),o=r(48088),i=r(37719),a=r(73095),u=r(83055),c=r(58288),l=r(11308),d=r(48240),p=r(62351),g=r(32190);async function f(e){let t=await e.formData();if(await (0,a.o)(),!t.has("title")||!t.has("content")||!t.has("image"))return g.NextResponse.json({error:"Missing required fields"},{status:400});let r=e.cookies.get("token")?.value,n=await (0,d.n)(r),{image:s,title:o,content:i}=Object.fromEntries(t);console.log("the title is",o,"content is",i);try{let e=await (0,l.V)(s,"blog");if(!e)return g.NextResponse.json({error:"File upload failed"},{status:500});let t=await u._.create({title:o,content:i,image:e,author:n?.id});if(!t)return g.NextResponse.json({error:"blog creation failed"},{status:500});let r=await u._.find().sort({createdAt:1});return r&&r.length>5&&(await u._.findByIdAndDelete(r[0]._id),(0,c.W)("blog",r[0].image)),["/","/blogs"].forEach(e=>(0,p.revalidatePath)(e)),g.NextResponse.json(t,{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.log(e),g.NextResponse.json({error:"something went wrong"},{status:500})}}async function m(e){try{await (0,a.o)();let e=await u._.find().sort({createdAt:-1});return g.NextResponse.json(e,{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.log(e),g.NextResponse.json({error:"something went wrong"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/blog/route",pathname:"/api/blog",filename:"route",bundlePath:"app/api/blog/route"},resolvedPagePath:"C:\\Users\\Shipon Islam\\Desktop\\Next-Project\\fabusiness\\src\\app\\api\\blog\\route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:y,workUnitAsyncStorage:w,serverHooks:x}=h;function v(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:w})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11308:(e,t,r)=>{"use strict";r.d(t,{V:()=>g});var n=r(29021),s=r.n(n),o=r(33873),i=r.n(o),a=r(55511);let u={randomUUID:a.randomUUID},c=new Uint8Array(256),l=c.length,d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));let p=function(e,t,r){if(u.randomUUID&&!t&&!e)return u.randomUUID();let n=(e=e||{}).random??e.rng?.()??(l>c.length-16&&((0,a.randomFillSync)(c),l=0),c.slice(l,l+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase()}(n)},g=async(e,t)=>{let r=await e.arrayBuffer(),n=Buffer.from(r),o=i().join(process.cwd(),"uploads",t);s().existsSync(o)||s().mkdirSync(o,{recursive:!0});let a=p()+"-"+e.name,u=i().join(o,a);return s().writeFileSync(u,n),a}},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48240:(e,t,r)=>{"use strict";r.d(t,{n:()=>c,z:()=>u});var n=r(87806),s=r(77412);let o=process.env.JWT_SECRET,i=parseInt(process.env.JWT_TOKEN_EXPIRED||"86400"),a=new TextEncoder().encode(o);async function u(e){return await new n.P(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(`${i}s`).sign(a)}async function c(e){try{let{payload:t}=await (0,s.V)(e,a);if("admin"===t.role)return t;return null}catch(e){return console.error("Token verification failed:",e.message),null}}},55511:e=>{"use strict";e.exports=require("crypto")},56037:e=>{"use strict";e.exports=require("mongoose")},58288:(e,t,r)=>{"use strict";r.d(t,{W:()=>a});var n=r(29021),s=r.n(n),o=r(33873),i=r.n(o);let a=(e,t)=>{let r=i().join(process.cwd(),"uploads",e,t);return!!s().existsSync(r)&&(s().unlinkSync(r),!0)}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73095:(e,t,r)=>{"use strict";r.d(t,{o:()=>o});var n=r(56037),s=r.n(n);async function o(){s().connections[0].readyState||await s().connect(process.env.DATABASE_URL||"")}},78335:()=>{},83055:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});var n=r(56037),s=r.n(n);let o=new(s()).Schema({title:{type:String,required:!0,trim:!0,minlength:3},author:{type:s().Schema.Types.ObjectId,ref:"User",required:!0},content:{type:String,required:!0,trim:!0,minlength:10},image:{type:String,required:!0}},{timestamps:!0}),i=n.models.Blog||s().model("Blog",o)},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4447,580,4553,2351],()=>r(9819));module.exports=n})();